<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tama Studios — Employee Rolodex</title>
  <style>
    :root {
      --bg: #0b0c10;
      --panel: #0f1117;
      --text: #e6e6e6;
      --muted: #9aa0a6;
      --ring: #2dd4bf;
      --accent: #7c3aed;
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font: 15px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans";
      display: grid;
      grid-template-rows: auto 1fr auto;
      min-height: 100dvh;
    }

    header, main, footer { width: min(1100px, 92vw); margin: 0 auto; }
    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; padding: 24px 0; }

    /* Tama Studios branding */
    .brand { display: flex; align-items: center; gap: 12px }
    .brand-mark {
      width: 40px; height: 40px; border-radius: 10px;
      background: conic-gradient(from 200deg, var(--accent), var(--ring));
      box-shadow: 0 6px 24px rgb(0 0 0 / 0.35);
    }
    .brand h1 { margin: 0; font-size: clamp(20px, 3vw, 28px) }
    .brand h1 span { color: var(--ring) }

    .sub { color: var(--muted); margin: 4px 0 0 }

    /* Layout */
    .wrap { display: grid; grid-template-columns: 1fr 120px; gap: 24px; align-items: center }

    /* Rolodex */
    .rolodex {
      position: relative; height: 440px; perspective: 1200px; background: var(--panel);
      border-radius: 20px; outline: 1px solid color-mix(in oklab, var(--panel), white 8%);
      box-shadow: 0 12px 48px rgb(0 0 0 / 0.45);
      overflow: hidden;
    }
    .stage { position: absolute; inset: 0; transform-style: preserve-3d; display: grid; place-items: center; }

    .card { position: absolute; width: 260px; height: 320px; padding: 14px; border-radius: 18px;
      background: color-mix(in oklab, var(--panel), black 6%);
      box-shadow: 0 10px 40px rgb(0 0 0 / 0.45);
      display: grid; grid-template-rows: 180px auto; gap: 10px;
      outline: 1px solid color-mix(in oklab, var(--panel), white 10%);
      backface-visibility: hidden;
    }
    .card img { width: 100%; height: 100%; object-fit: cover; border-radius: 12px; background: #000 }
    .card h3 { margin: 0; font-size: 18px }
    .card p { margin: 0; color: var(--muted) }

    /* Wheel control */
    .wheel-col { display: grid; align-content: center; justify-items: center }
    .wheel {
      width: 92px; height: 260px; border-radius: 999px; background: color-mix(in oklab, var(--panel), white 6%);
      outline: 1px solid color-mix(in oklab, var(--panel), white 10%);
      position: relative; user-select: none; touch-action: none; cursor: grab;
    }
    .wheel:active { cursor: grabbing }
    .notch { position: absolute; left: 50%; top: 50%; width: 64px; height: 6px; border-radius: 3px;
      transform: translate(-50%, -50%); background: color-mix(in oklab, var(--ring), white 20%);
      box-shadow: 0 0 0 2px rgb(0 0 0 / 0.2);
    }
    .tick { position: absolute; left: 50%; width: 40px; height: 2px; background: #2a2d39; transform-origin: left center }

    .hud { position: absolute; right: 10px; bottom: 10px; color: var(--muted); font-size: 12px }

    footer { color: var(--muted); padding: 18px 0 38px }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0 }
    @media (max-width: 840px){ .wrap{ grid-template-columns: 1fr } .wheel-col{ order:-1 } }
  </style>
</head>
<body>
  <header>
    <div class="brand" aria-label="Tama Studios">
      <div class="brand-mark" aria-hidden="true"></div>
      <div>
        <h1>Tama <span>Studios</span></h1>
        <p class="sub">Employee Rolodex</p>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="rolodex" aria-live="polite">
      <div class="stage" id="stage"></div>
      <div class="hud" id="hud" aria-hidden="true"></div>
    </section>
    <aside class="wheel-col">
      <div id="wheel" class="wheel" aria-label="Turn wheel to flip cards" role="slider" aria-valuemin="0" aria-valuemax="0" aria-valuenow="0">
        <div class="notch"></div>
      </div>
      <p class="sub" style="text-align:center">Turn wheel • Scroll • ↑/↓</p>
    </aside>
  </main>

  <footer>
    Data comes from <code>employeeinfo.json</code>. If the file is missing, demo cards are shown.
  </footer>

  <script>
    // ================= Employee Rolodex with Wheel + Physics =================
    (function(){
      const stage = document.getElementById('stage');
      const wheel = document.getElementById('wheel');
      const hud = document.getElementById('hud');

      // Physics state
      let angle = 0;         // degrees
      let velocity = 0;      // degrees per frame
      let dragging = false;
      let lastY = 0;

      const R = 360;         // translateZ radius for cards
      let step = 30;         // will be recomputed from n
      let n = 0;
      let cards = [];

      // Accessibility
      function updateAria(){
        wheel.setAttribute('aria-valuemax', String(Math.max(0, n - 1)));
        const idx = Math.round(-angle / step) % n;
        wheel.setAttribute('aria-valuenow', String((idx + n) % n));
      }

      async function loadEmployees(){
        try{
          const res = await fetch('employeeinfo.json', { cache: 'no-store' });
          if(!res.ok) throw 0;
          const data = await res.json();
          // Support array or object schema without inventing fields
          if(Array.isArray(data)){
            return data.map(x => ({
              name: (x && x.name) ? String(x.name) : '',
              title: (x && x.title) ? String(x.title) : '',
              photo: (x && x.photo) ? String(x.photo) : ''
            }));
          } else if (data && typeof data === 'object') {
            return Object.keys(data).map(k => {
              const x = data[k] || {};
              return {
                name: String(k),
                title: x.role ? String(x.role) : '',
                photo: x.pfp ? String(x.pfp) : ''
              };
            });
          }
          return [];
        }catch(e){
          // Fallback demo data from prior version
          return [
            { name: 'DJ', title: 'CO-Owner', photo: 'https://64.media.tumblr.com/ae674249408d93802da747ff920f69ee/06e0008482d0b5bd-f7/s1280x1920/c6e58dc8ecb643ccf2226bd35122cee76a462cd3.pnj' },
            { name: 'Tommie', title: 'CO-Owner', photo: 'https://picsum.photos/seed/b/400/500' },
            { name: 'Codiak', title: 'Owner', photo: 'https://picsum.photos/seed/c/400/500' },
            { name: 'Missing data', title: 'Missing data', photo: 'https://tamastudios.us/assets/sitewide/logo_plain.png' },
            { name: 'Missing data', title: 'Missing data', photo: 'https://tamastudios.us/assets/sitewide/logo_plain.png' }
          ];
        }
      }

      function makeCard(emp){
        const d = document.createElement('article');
        d.className = 'card';
        const img = emp.photo ? emp.photo : '';
        d.innerHTML = `
          <img alt="${emp.name}" loading="lazy" src="${img}">
          <div>
            <h3>${emp.name ?? ''}</h3>
            <p>${emp.title ?? ''}</p>
          </div>
        `;
        return d;
      }

      function layout(){
        n = cards.length;
        if(n === 0){ stage.innerHTML = '<p class="sub" style="position:absolute;inset:0;display:grid;place-items:center">No employees found.</p>'; return; }
        step = 360 / n;
        stage.innerHTML = '';
        cards.forEach((c, i) => {
          const a = i * step; // degrees around X axis
          c.style.transform = `rotateX(${a}deg) translateZ(${R}px)`;
          stage.appendChild(c);
        });
        updateAria();
      }

      function applyTransform(){
        stage.style.transform = `rotateX(${angle}deg)`;
        if(n){
          const active = ((Math.round((-angle) / step) % n) + n) % n;
          hud.textContent = `${active + 1} / ${n}`;
        }
      }

      function animate(){
        // Integrate velocity
        angle += velocity;
        // Friction
        velocity *= dragging ? 0.9 : 0.94;

        // Snap to nearest card when not dragging and slow
        if(!dragging && n){
          const nearest = Math.round(angle / step) * step;
          const delta = nearest - angle;
          const spring = 0.08;
          velocity += delta * spring; // spring toward target
          if(Math.abs(delta) < 0.02 && Math.abs(velocity) < 0.02){
            angle = nearest; velocity = 0;
          }
        }
        applyTransform();
        requestAnimationFrame(animate);
      }

      // Wheel interactions
      function onDown(e){ dragging = true; lastY = (e.touches? e.touches[0].clientY : e.clientY); e.preventDefault(); }
      function onMove(e){ if(!dragging) return; const y = (e.touches? e.touches[0].clientY : e.clientY); const dy = y - lastY; lastY = y; velocity += dy * -0.25; }
      function onUp(){ dragging = false; }

      wheel.addEventListener('mousedown', onDown);
      window.addEventListener('mousemove', onMove);
      window.addEventListener('mouseup', onUp);
      wheel.addEventListener('touchstart', onDown, { passive: false });
      window.addEventListener('touchmove', onMove, { passive: false });
      window.addEventListener('touchend', onUp);

      // Scroll support
      wheel.addEventListener('wheel', (e)=>{ velocity += Math.sign(e.deltaY) * step * 0.6; });

      // Keyboard support
      window.addEventListener('keydown', (e)=>{
        if(e.key === 'ArrowDown') velocity += step * 0.9;
        if(e.key === 'ArrowUp') velocity -= step * 0.9;
      });

      // Init
      (async ()=>{
        const employees = await loadEmployees();
        cards = employees.map(makeCard);
        layout();
        applyTransform();
        requestAnimationFrame(animate);
      })();
    })();
  </script>
</body>
</html>
